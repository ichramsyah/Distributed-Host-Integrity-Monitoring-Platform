# =============================================================================
# âš  DISCLAIMER
# This GitHub Actions workflow is provided for portfolio and showcase purposes.  Actual production
# configurations, credentials, and infrastructure details are managed securely and are not included in this
# repository.
#
# It demonstrates a production-like DevSecOps CI/CD pipeline (security scanning
# and automated deployment).
#
# Actual production pipelines use separate repositories, restricted runners,
# protected secrets, and environment-specific controls.
# =============================================================================

name: Production Build & Deploy Pipeline

on:
  push:
    branches: ['main']

jobs:
  deploy:
    name: DevSecOps CI/CD Pipeline
    runs-on: self-hosted

    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Security Scan (Trivy)
        # Shift-Left Security: Fails the pipeline if Critical vulnerabilities are found
        run: |
          trivy fs . \
            --severity CRITICAL,HIGH \
            --format table \
            --ignore-unfixed \
            --exit-code 1

      - name: Deployment (Ansible)
        if: success()
        run: |
          echo "âœ… Security Scan Passed! Initiating deployment..."

          # Change with your infra repo path
          cd /home/runner/fim_infra 

          # Change with your deployment command
          ansible-playbook -i inventory.ini deploy_backend.yml

          echo "ðŸŽ‰ Deployment Completed Successfully!!"
